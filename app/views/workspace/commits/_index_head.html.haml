-#  Copyright (C) 2013, 2014, 2015 Dr. Thomas Schank  (DrTom@schank.ch, Thomas.Schank@algocon.ch)
-#  Licensed under the terms of the GNU Affero General Public License v3.
-#  See the LICENSE.txt file provided with this software.

- cache [params] do

  .pull-right

    = form_tag workspace_commits_path, method: 'GET', class: "form-inline well right-top-form", role: 'form' do
      %fieldset
        .pull-left
          %ul.list-inline
            %li
              .form-group
                %label.sr-only{for: "repository_names"}
                = text_field :repository, :names, placeholder: "Repository name 1, ...",
                  value: repository_names_filter.join(", "),
                  data: {autocomplete_path: names_workspace_repositories_path},
                  class: "input-medium form-control input-sm"
            %li
              .form-group
                %label.sr-only{for: "branch_names"}
                = text_field :branch, :names, placeholder: "Branch name 1, ...",
                  value: branch_names_filter.join(", "),
                  data:{autocomplete_path: names_workspace_branches_path},
                  class: "input-medium form-control input-sm"
            %li
              .form-group
                %label.sr-only{for: "commit_text"}
                =text_field :commit, :text, placeholder: "Commits text search",
                  value: commit_text_search_filter,
                  class: "search-query form-control input-sm"


      %fieldset
        .pull-right
          %ul.list-inline

            %li

              .form-group
                %label.sr-only{for: "depth"}
                = select_tag :depth,
                  options_for_select([["Branch heads only âš“ ",0],
                    ["Up to depth 2",2], ["Up to depth 5",5],
                    ["Any depth and orphans",-1]],
                    params[:depth] || 0),
                  class: "form-control input-sm"

            %li
              = render 'per_page_form_group'

            %li
              = link_to workspace_commits_path, class: 'btn btn-sm btn-warning' do
                %i.icon-remove-sign
                Reset


            %li
              = button_tag type: 'submit', class: 'btn btn-sm btn-primary' do
                %i.icon-filter
                Filter


  %h1
    Commits

    -case
    -when branch_names_filter.count == 1
      of the branch #{branch_names_filter.join(", ")}
    -when branch_names_filter.count > 1
      of the branches #{branch_names_filter.join(", ")}

    -case
    -when repository_names_filter.count == 1
      in the repository #{repository_names_filter.join(", ")}
    -when repository_names_filter.count > 1
      in the repositories #{repository_names_filter.join(", ")}


  .clearfix
